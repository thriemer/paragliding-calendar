# Story 2.2: Wind Analysis Engine

## Status
Draft

## Story
**As a** paragliding pilot,
**I want** the system to analyze wind conditions against site launch orientations,
**so that** I can understand which sites are flyable on specific days.

## Acceptance Criteria

1: Wind direction and speed analysis implemented for each site
2: Launch direction compatibility logic (favorable, marginal, unfavorable wind angles)
3: Wind strength assessment relative to site requirements and pilot skill levels
4: Calculation accounts for weather forecast uncertainty and safety margins
5: Clear flyability scoring system (0-10 scale or similar) with explanatory reasoning

## Tasks / Subtasks

- [ ] Implement wind direction analysis algorithm (AC: 1, 2)
  - [ ] Parse wind direction from weather data (degrees from north)
  - [ ] Convert site launch directions to consistent format (DHV codes to degrees)
  - [ ] Calculate angular differences between wind and launch directions
  - [ ] Determine favorable wind angle ranges (e.g., ±45° for favorable, ±90° for marginal)
- [ ] Implement wind speed analysis (AC: 1, 3)
  - [ ] Extract wind speed from weather forecasts
  - [ ] Define wind speed categories (light, moderate, strong, dangerous)
  - [ ] Account for skill level requirements (beginner vs advanced pilot limits)
  - [ ] Consider gusting factors and wind consistency
- [ ] Create launch direction compatibility engine (AC: 2)
  - [ ] Map DHV direction codes to compass directions
  - [ ] Handle multiple launch directions per site
  - [ ] Implement cross-wind and head/tail wind analysis
  - [ ] Account for terrain and topographic wind effects
- [ ] Implement safety margin calculations (AC: 4)
  - [ ] Add uncertainty buffers for forecast accuracy
  - [ ] Apply conservative factors for marginal conditions
  - [ ] Consider forecast confidence levels if available
  - [ ] Implement time-based uncertainty increase (forecast degrades over time)
- [ ] Create flyability scoring system (AC: 5)
  - [ ] Design 0-10 scoring scale with clear criteria
  - [ ] Combine wind direction, speed, and safety factors
  - [ ] Generate explanatory text for each score
  - [ ] Provide reasoning for non-flyable conditions

## Dev Notes

### Relevant Source Tree Info
- Integrate with weather data structures from Epic 1 Story 1.3
- Use site data from Story 2.1 for launch direction information
- Apply error handling patterns from Story 1.4

### Wind Analysis Logic
- **DHV Direction Mapping:** Convert codes like "3B" and text like "O, W" to compass degrees
- **Favorable Wind Range:** Typically ±45° from launch direction
- **Marginal Wind Range:** ±45° to ±90° from launch direction
- **Unfavorable:** >90° cross-wind or strong tail wind

### Direction Code Conversion (DHV)
- Need to map DHV directional codes to compass directions
- Examples from XML: "O, W" = East, West; "SSW-WSW" = South-Southwest to West-Southwest
- Handle multiple directions per site (some sites have multiple launch options)

### Scoring Algorithm Framework
```
Score 9-10: Perfect conditions (favorable wind, optimal speed)
Score 7-8: Good conditions (favorable wind, acceptable speed)
Score 5-6: Marginal conditions (borderline wind direction/speed)
Score 3-4: Poor conditions (unfavorable but potentially flyable)
Score 0-2: Dangerous/Non-flyable conditions
```

### Wind Speed Categories
- **Light:** 0-15 km/h (good for beginners)
- **Moderate:** 15-25 km/h (good for most pilots)
- **Strong:** 25-35 km/h (experienced pilots only)
- **Dangerous:** >35 km/h (generally non-flyable)

### Safety Considerations
- Add conservative buffers for forecast uncertainty
- Consider local terrain effects on wind patterns
- Account for thermal activity and convective conditions
- Implement pilot skill level adjustments

### Testing
**Test file location:** tests/unit/ and tests/integration/
**Testing frameworks:** Standard Rust unit tests, property-based testing for wind calculations
**Test standards:**
- Unit tests for direction conversion algorithms
- Unit tests for wind speed categorization
- Unit tests for scoring algorithm with various wind conditions
- Integration tests combining weather data with site data
- Property-based tests for edge cases in wind calculations
- Test cases covering all DHV direction codes and combinations

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-30 | v1.0 | Initial story creation for wind analysis engine | Sarah (PO) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be completed during implementation*

### Debug Log References
*To be completed during implementation*

### Completion Notes List
*To be completed during implementation*

### File List
*To be completed during implementation*

## QA Results

*Results from QA Agent review will be populated here after implementation*